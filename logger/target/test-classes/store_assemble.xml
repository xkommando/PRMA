<?xml version="1.0" encoding="ISO-8859-1"?>
<beans namespace="prma::internal::store">

    <!--for test only-->
    <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">
        <prop name="driverClassName" val="com.mysql.jdbc.Driver"/>
        <prop name="username" val="bitranger" />
        <prop name="password" val="123456"/>
        <prop name="jdbcUrl" val="jdbc:mysql://localhost:3306/prma_log" />
        <prop name="autoCommit" val="false" />

        <prop name="minimumIdle" val="2"/>
        <prop name="maximumPoolSize" val="16"/>
    </bean>

    <!--DataSource shall be added from this context BEFORE CENTURY-->


    <bean id="sqlLoader" class="com.caibowen.prma.core.StrLoader" aftercall="start">
        <construct name="paths">
            <list>
                <val>classpath:query2_mysql.xml</val>
            </list>
        </construct>
    </bean>

    <!--<bean id="classNameFilter" class="com.caibowen.prma.core.filter.PartialStrFilter" aftercall="start">-->
        <!--<construct val="ignored_classes.txt"/>-->
    <!--</bean>-->

    <bean id="exceptNameStore" class="com.caibowen.prma.store.rdb.impl.StrStore">
        <construct val="`exception_name`"/>
        <prop name="dataSource" ref="dataSource"/>
    </bean>
    <bean id="exceptMsgStore" class="com.caibowen.prma.store.rdb.impl.StrStore">
        <construct val="`exception_msg`"/>
        <prop name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="stackTraceStore" class="com.caibowen.prma.store.rdb.impl.StackTraceStore">
        <construct ref="sqlLoader"/>
        <prop name="dataSource" ref="dataSource"/>
    </bean>


    <bean id="eventStoreAux" class="com.caibowen.prma.store.rdb.impl.StoreAuxImpl">
        <construct ref="sqlLoader"/>
        <prop name="dataSource" ref="dataSource"/>
        <prop name="exceptNameStore" ref="exceptNameStore"/>
        <prop name="exceptMsgStore" ref="exceptMsgStore"/>
        <prop name="stackStore" ref="stackTraceStore"/>
    </bean>

    <!-- -->

    <bean id="eventSQL" class="com.caibowen.prma.core.StrLoader" aftercall="start">
        <construct name="paths">
            <list>
                <val>classpath:query1_mysql.xml</val>
            </list>
        </construct>
    </bean>

    <bean id="loggerNameStore" class="com.caibowen.prma.store.rdb.impl.StrStore">
        <construct val="`logger_name`"/>
        <prop name="dataSource" ref="dataSource"/>
    </bean>
    <bean id="threadStore" class="com.caibowen.prma.store.rdb.impl.StrStore">
        <construct val="`thread_name`"/>
        <prop name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="eventStore" class="com.caibowen.prma.store.rdb.StoreBuilder">
        <prop name="sqls" ref="eventSQL"/>
        <prop name="dataSource" ref="dataSource"/>
        <prop name="eventAux" ref="eventStoreAux"/>
        <prop name="loggerNameStore" ref="loggerNameStore"/>
        <prop name="threadStore" ref="threadStore"/>
        <prop name="stackStore" ref="stackTraceStore"/>
    </bean>

    <!--<bean class="com.caibowen.prma.store.rdb.Test" aftercall="init">-->
        <!--<construct>-->
            <!--<ref>eventSQL</ref>-->
            <!--<ref>dataSource</ref>-->
        <!--</construct>-->
        <!--<prop name="b1" ref="eventSQL"/>-->
    <!--</bean>-->

</beans>
